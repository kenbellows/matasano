<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Single-byte XOR cipher</title>
  </head>
  <body>
  <p>
    Enter a single-byte XORd, hex-encoded ciphertext then hit "Convert" to decode it.
  </p>
  <p>
    <h4>
      XORd Ciphertext
    </h4>
    <textarea id="cipher" name="cipher" cols="30" rows="10"></textarea>
  </p>
  <p>
    <h4>
      Plaintext
    </h4>
    <textarea id="plain" name="plain" cols="30" rows="10"></textarea>
  </p>
  <p>
    <button onclick="go()">Convert</button>
  </p>
  <div id="log"></div>
  <script>
  function go() {
    document.getElementById("plain").value = decode(document.getElementById("cipher").value);
  }
  
  function decode(hex_cipher) {
    var cipher = hexDecode(hex_cipher),
        winner = "",
        winning_score = 0;
    for (var xor_byte=0x20; xor_byte<0x7f; xor_byte++) {
      var plaintext = "",
          continue_flag = false;
      for (var j=0; j<cipher.length; j++) {
        var next_chr = cipher.charCodeAt(j)^xor_byte;
        if (next_chr > 0x7e || next_chr < 0x20) { continue_flag = true; break; }
        plaintext += String.fromCharCode(next_chr);
      }
      if (continue_flag) continue;
      var this_score = score(plaintext);
      if (this_score > winning_score) {
        winning_score = this_score;
        winner = plaintext;
      }
    }
    return winner;
  }
  function log(s) { document.getElementById("log").innerHTML += "<p>"+s+"</p>"; }

  //var frequencies = "etaoinshrdlcumwfgypbvkjxqz";
  var frequencies = {
    e : 12.702, 
    t : 9.056,  
    a : 8.167,  
    o : 7.507,  
    i : 6.966,  
    n : 6.749,  
    s : 6.327,  
    h : 6.094,  
    r : 5.987,  
    d : 4.253,  
    l : 4.025,  
    c : 2.782,  
    u : 2.758,  
    m : 2.406,  
    w : 2.360,  
    f : 2.228,  
    g : 2.015,  
    y : 1.974,  
    p : 1.929,  
    b : 1.492,  
    v : 0.978,  
    k : 0.772,  
    j : 0.153,  
    x : 0.150,  
    q : 0.095,  
    z : 0.074,  
  };
  function score(plaintext) {
    var _score = 0;
    for (var i=0; i<plaintext.length; i++) {
      var chr = plaintext.charAt(i).toLowerCase();
      //var freq = frequencies.indexOf(chr);
      if (chr.charCodeAt(0) > 0x7e || chr.charCodeAt(0) < 0x20) return 0; // any non-printable characters render this string a loser
      //if (freq != -1) _score += frequencies.length - freq;
      if (frequencies.hasOwnProperty(chr)) _score += frequencies[chr];
    }
    return _score;
  }
  function hexDecode(hex_str) {
    var num_chrs = hex_str.length/2,
        str = "";
    for (var i=0; i<num_chrs; i++) {
      str += String.fromCharCode(parseInt(hex_str.substr(i,2),16));
    }
    return str;
  }
  </script>
  </body>
</html>

